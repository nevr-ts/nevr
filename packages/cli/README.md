# @nevr/cli

> Command-line interface for [Nevr](https://github.com/nevr-ts/nevr) â€” Generate Prisma schemas and typed clients from your entities

<p align="center">
  <a href="https://www.npmjs.com/package/@nevr/cli"><img src="https://img.shields.io/npm/v/@nevr/cli.svg?style=flat-square&color=blue" alt="npm version"></a>
  <a href="https://www.npmjs.com/package/@nevr/cli"><img src="https://img.shields.io/npm/dm/@nevr/cli.svg?style=flat-square" alt="npm downloads"></a>
  <a href="https://github.com/nevr-ts/nevr/blob/main/LICENSE"><img src="https://img.shields.io/badge/license-MIT-green.svg?style=flat-square" alt="license"></a>
</p>

---

## ğŸ“¦ Installation

```bash
# Global installation
npm install -g @nevr/cli

# Or use directly with npx (recommended)
npx @nevr/cli generate
```

## ğŸš€ Quick Start

1. **Create a config file** (`nevr.config.ts`):

```typescript
import { entity, string, text, belongsTo } from "nevr"

export const user = entity("user", {
  email: string.unique(),
  name: string.min(1).max(100),
}).build()

export const post = entity("post", {
  title: string.min(1).max(200),
  body: text,
  author: belongsTo(() => user),
})
  .ownedBy("author")
  .build()

export default {
  entities: [user, post],
}
```

2. **Generate everything**:

```bash
npx @nevr/cli generate
```

3. **Push to database**:

```bash
npx prisma db push --schema=./generated/prisma/schema.prisma
```

## ğŸ“– Commands

### `nevr generate`

Generate Prisma schema, TypeScript types, and API client from your entity definitions.

```bash
nevr generate [options]
```

**Options:**

| Option | Description | Default |
|--------|-------------|---------|
| `-c, --config <path>` | Path to nevr config file | `./nevr.config.ts` |
| `-o, --out <dir>` | Output directory | `./generated` |
| `-p, --provider <db>` | Database provider: `sqlite`, `postgresql`, `mysql` | `sqlite` |

**Examples:**

```bash
# Default configuration
nevr generate

# PostgreSQL with custom output
nevr generate --provider postgresql --out ./src/generated

# Custom config file
nevr generate --config ./config/api.config.ts
```

### `nevr init`

Display help for initializing a new nevr project.

```bash
nevr init
```

> ğŸ’¡ **Tip:** For full project scaffolding with a complete setup, use:
> ```bash
> npm create nevr@latest
> ```

## ğŸ“ Generated Output

Running `nevr generate` creates the following structure:

```
generated/
â”œâ”€â”€ prisma/
â”‚   â””â”€â”€ schema.prisma    # Prisma database schema
â”œâ”€â”€ types.ts             # TypeScript interfaces
â””â”€â”€ client.ts            # Type-safe API client
```

### `schema.prisma`

Complete Prisma schema with all your entities, relations, and indexes:

```prisma
// Generated by @nevr/cli - DO NOT EDIT

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model User {
  id    String @id @default(cuid())
  email String @unique
  name  String
  posts Post[]
}

model Post {
  id       String @id @default(cuid())
  title    String
  body     String
  authorId String
  author   User   @relation(fields: [authorId], references: [id])
}
```

### `types.ts`

Type-safe interfaces for all entities:

```typescript
// Generated by @nevr/cli - DO NOT EDIT

export interface User {
  id: string
  email: string
  name: string
}

export interface Post {
  id: string
  title: string
  body: string
  authorId: string
}
```

### `client.ts`

Ready-to-use API client for your frontend:

```typescript
// Generated by @nevr/cli - DO NOT EDIT

import type { User, Post } from "./types"

export const api = {
  users: {
    list: () => fetch("/api/users").then(r => r.json()) as Promise<User[]>,
    get: (id: string) => fetch(`/api/users/${id}`).then(r => r.json()) as Promise<User>,
    create: (data: Omit<User, "id">) => /* ... */,
    update: (id: string, data: Partial<User>) => /* ... */,
    delete: (id: string) => /* ... */,
  },
  posts: { /* ... */ },
}
```

## âš™ï¸ Configuration Reference

Full configuration options in `nevr.config.ts`:

```typescript
import { entity, string, text, int, bool, datetime, belongsTo } from "nevr"
import { auth } from "nevr/plugins/auth"
import { timestamps } from "nevr/plugins/timestamps"

// Define entities
export const user = entity("user", {
  email: string.unique(),
  name: string,
}).build()

export const post = entity("post", {
  title: string.min(1).max(200),
  content: text,
  published: bool.default(false),
  author: belongsTo(() => user),
})
  .ownedBy("author")
  .rules({
    create: ["authenticated"],
    read: ["everyone"],
    update: ["owner"],
    delete: ["owner", "admin"],
  })
  .build()

// Export configuration
export default {
  entities: [user, post],
  plugins: [
    auth({ emailAndPassword: true }),
    timestamps(),
  ],
}
```

## ğŸ”„ Workflow

Typical development workflow with the CLI:

```bash
# 1. Edit your entities in nevr.config.ts

# 2. Regenerate everything
npx @nevr/cli generate

# 3. Apply database changes
npx prisma db push --schema=./generated/prisma/schema.prisma

# 4. (Optional) View your database
npx prisma studio --schema=./generated/prisma/schema.prisma
```

## ğŸ“š Related Packages

| Package | Description |
|---------|-------------|
| [`nevr`](https://www.npmjs.com/package/nevr) | Core framework |
| [`@nevr/generator`](https://www.npmjs.com/package/@nevr/generator) | Generator library (used internally) |
| [`create-nevr`](https://www.npmjs.com/package/create-nevr) | Project scaffolder |

## ğŸ¤ Contributing

We welcome contributions! See our [Contributing Guide](https://github.com/nevr-ts/nevr/blob/main/CONTRIBUTING.md).

## ğŸ“„ License

[MIT](https://github.com/nevr-ts/nevr/blob/main/LICENSE) Â© Nevr Contributors
